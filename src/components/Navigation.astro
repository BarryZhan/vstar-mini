---
import Logo from '../assets/logo.svg'
import HeaderMenu from '../assets/header-menu.svg'
// 导航栏组件
interface Props {
  transparent?: boolean
}

const { transparent = false } = Astro.props

const menuItems = [
  { label: '首页', href: '/' },
  { label: '关于我们', href: '/about' },
  { label: '全球合规', href: '/compliance' },
  { label: '技术实力', href: '/technology' },
  { label: '联系我们', href: '/contact' },
]
---

<nav
  id="main-nav"
  class="fixed left-0 right-0 top-0 z-50 px-6 py-4 transition-transform duration-300 md:px-12 md:py-6 lg:px-20"
>
  <!-- 带圆角的导航容器 -->
  <div
    id="nav-container"
    class="mx-auto flex max-w-[1400px] items-center justify-between rounded-full bg-white px-6 py-4 shadow-lg transition-all duration-300 md:px-8 md:py-5 lg:px-12"
  >
    <!-- Logo -->
    <a
      href="/"
      class="z-10 flex items-center transition-opacity hover:opacity-80"
    >
      <Logo class="h-7 w-28 md:h-8 md:w-32 lg:h-9 lg:w-36" />
    </a>

    <!-- PC端导航菜单 -->
    <div class="hidden items-center gap-8 lg:flex lg:gap-12">
      {
        menuItems.map((item) => (
          <a
            href={item.href}
            class="menu-link whitespace-nowrap text-lg font-medium text-black transition-colors hover:text-primary lg:text-xl"
          >
            {item.label}
          </a>
        ))
      }
    </div>

    <!-- 移动端菜单按钮 -->
    <HeaderMenu
      class="z-10 flex size-6 flex-col transition-opacity hover:opacity-80 lg:hidden"
      aria-label="Menu"
      id="menu-button"
    />
  </div>
</nav>

<script>
  // 移动端菜单切换逻辑
  const menuButton = document.getElementById('menu-button')
  menuButton?.addEventListener('click', () => {
    console.log('Menu clicked')
    // TODO: 实现移动端菜单展开逻辑
  })

  // 导航栏滚动交互逻辑
  let lastScrollY = 0
  let ticking = false

  const nav = document.getElementById('main-nav')
  const navContainer = document.getElementById('nav-container')
  const menuLinks = document.querySelectorAll('.menu-link')

  function updateNavigation() {
    const currentScrollY = window.scrollY
    const heroSection = document.getElementById('hero-section')
    const heroHeight = heroSection?.offsetHeight || 0

    // 判断滚动方向
    const isScrollingDown = currentScrollY > lastScrollY
    const isScrollingUp = currentScrollY < lastScrollY

    // 判断是否超出 Hero 区域
    const isOutOfHero = currentScrollY > heroHeight

    if (nav) {
      // 滚动方向控制显示/隐藏
      if (isScrollingDown && currentScrollY > 100) {
        // 向下滚动且超过100px时隐藏
        nav.style.transform = 'translateY(-100%)'
      } else if (isScrollingUp || currentScrollY <= 100) {
        // 向上滚动或在顶部附近时显示
        nav.style.transform = 'translateY(0)'
      }
    }

    // 颜色切换逻辑
    if (navContainer) {
      if (isOutOfHero) {
        // 超出 Hero 区域：背景黑色，文字白色
        navContainer.style.backgroundColor = '#000000'
        menuLinks.forEach((link) => {
          link.style.color = '#ffffff'
        })
      } else {
        // 在 Hero 区域内：背景白色，文字黑色
        navContainer.style.backgroundColor = '#ffffff'
        menuLinks.forEach((link) => {
          link.style.color = '#000000'
        })
      }
    }

    lastScrollY = currentScrollY
    ticking = false
  }

  function requestTick() {
    if (!ticking) {
      requestAnimationFrame(updateNavigation)
      ticking = true
    }
  }

  // 监听滚动事件
  window.addEventListener('scroll', requestTick, { passive: true })

  // 初始化
  updateNavigation()
</script>
