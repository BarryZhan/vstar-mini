---
import Logo from '../assets/logo.svg'
import LogoDark from '../assets/logo-dark.svg'
import HeaderMenu from '../assets/header-menu.svg'
import CloseIcon from '../assets/close-icon.svg'
import MobileMenu from './MobileMenu.astro'
// 导航栏组件
interface Props {
  transparent?: boolean
}

const { transparent = false } = Astro.props

const menuItems = [
  { label: '首页', href: '/' },
  { label: '关于我们', href: '/about' },
  { label: '全球合规', href: '/compliance' },
  { label: '技术实力', href: '/technology' },
  { label: '联系我们', href: '/contact' },
]
---

<nav
  id="nav-container"
  class="fixed left-0 right-0 top-0 z-[100] bg-transparent transition-transform duration-300"
>
  <!-- 导航容器 -->
  <div
    class="content-container mx-auto flex h-[72px] items-center justify-between py-[15px] transition-all duration-300 lg:px-8 lg:py-5 xl:px-12"
  >
    <!-- Logo -->
    <a
      href="/"
      id="logo-link"
      class="z-10 flex items-center transition-opacity hover:opacity-80"
    >
      <Logo id="logo-svg" class="h-7 w-28 md:h-8 md:w-32 lg:h-9 lg:w-36" />
      <LogoDark
        id="logo-svg-dark"
        class="hidden h-7 w-28 md:h-8 md:w-32 lg:h-9 lg:w-36"
      />
    </a>

    <!-- PC端导航菜单 -->
    <div
      id="nav-menu"
      class="mx-auto hidden h-20 items-center gap-8 px-20 lg:flex lg:gap-12 font-bold"
    >
      {
        menuItems.map((item) => (
          <a
            href={item.href}
            class="menu-link whitespace-nowrap text-lg text-white transition-colors hover:opacity-90 lg:text-xl"
          >
            {item.label}
          </a>
        ))
      }
    </div>

    <div class="hidden w-36 lg:block"></div>

    <!-- 移动端菜单按钮 -->
    <button
      id="menu-button"
      class="relative z-10 flex size-6 flex-col transition-opacity hover:opacity-80 lg:hidden"
      aria-label="打开菜单"
    >
      <HeaderMenu id="menu-icon" class="size-6 text-white transition-opacity" />
      <CloseIcon
        id="close-icon"
        class="absolute inset-0 size-6 text-white opacity-0 transition-opacity"
      />
    </button>
  </div>
</nav>

<!-- 移动端菜单组件 -->
<MobileMenu />

<script>
  // 获取元素
  const menuButton = document.getElementById('menu-button')
  const menuIcon = document.getElementById('menu-icon')
  const closeIcon = document.getElementById('close-icon')
  const navMenu = document.getElementById('nav-menu')
  const navContainer = document.getElementById('nav-container')

  let isMenuOpen = false

  // 移动端菜单切换逻辑
  menuButton?.addEventListener('click', () => {
    const isMobile = window.innerWidth < 1024

    if (!isMenuOpen) {
      // 打开菜单
      if (typeof (window as any).openMobileMenu === 'function') {
        ;(window as any).openMobileMenu()
        isMenuOpen = true

        // 切换图标
        if (menuIcon && closeIcon) {
          menuIcon.style.opacity = '0'
          closeIcon.style.opacity = '1'
        }

        // 移动端菜单打开时，强制背景变为黑色
        if (isMobile && navContainer) {
          navContainer.style.backgroundColor = '#020202'
        }
      }
    } else {
      // 关闭菜单
      if (typeof (window as any).closeMobileMenu === 'function') {
        ;(window as any).closeMobileMenu()
        isMenuOpen = false

        // 切换图标
        if (menuIcon && closeIcon) {
          menuIcon.style.opacity = '1'
          closeIcon.style.opacity = '0'
        }

        // 关闭菜单后，根据滚动位置恢复背景色
        if (isMobile && navContainer) {
          const currentScrollY = window.scrollY
          if (currentScrollY > 50) {
            navContainer.style.backgroundColor = '#020202'
          } else {
            navContainer.style.backgroundColor = 'transparent'
          }
        }
      }
    }
  })

  // 导航栏滚动交互逻辑
  let lastScrollY = 0
  let ticking = false

  function updateNavigation() {
    const currentScrollY = window.scrollY

    // 检查是否为移动端（宽度小于 1024px）
    const isMobile = window.innerWidth < 1024

    // 背景色和文字颜色切换逻辑
    if (navContainer && navMenu) {
      if (isMenuOpen) {
        // 菜单打开时，强制保持黑色
        navContainer.style.backgroundColor = '#020202'
      } else if (currentScrollY > 50) {
        // 滚动后变黑色
        navContainer.style.backgroundColor = '#020202'
        navContainer.style.boxShadow =
          '0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1)'
      } else {
        // 顶部透明
        navContainer.style.backgroundColor = 'transparent'
        navContainer.style.boxShadow = 'none'
      }
    }

    lastScrollY = currentScrollY
    ticking = false
  }

  function requestTick() {
    if (!ticking) {
      requestAnimationFrame(updateNavigation)
      ticking = true
    }
  }

  // 监听滚动事件
  window.addEventListener('scroll', requestTick, { passive: true })

  // 初始化
  updateNavigation()
</script>
